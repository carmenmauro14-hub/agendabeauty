<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scheda Cliente</title>
  <link rel="stylesheet" href="navbar.css">
  <link rel="stylesheet" href="cliente.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <!-- navbar bottom -->
  <div id="navbar-placeholder"></div>

  <main class="cliente-page">
    <!-- AREA SUPERIORE TINTA: header + hero + quick actions -->
    <div class="top-area">
      <!-- HEADER -->
      <header class="page-header">
        <button class="icon-btn" id="backBtn" aria-label="Indietro">
          <i class="fa-solid fa-chevron-left"></i>
        </button>
        <div class="header-actions">
          <button class="icon-btn pill-btn" id="editBtnTop" aria-label="Modifica">
            <i class="fa-solid fa-pen"></i>
            <span>Modifica</span>
          </button>
        </div>
      </header>

      <!-- HERO -->
      <section class="hero">
        <div class="avatar" id="avatarIniziali">AA</div>
        <div class="identity">
          <div class="display-name" id="displayName">—</div>
        </div>
      </section>

      <!-- QUICK ACTIONS (nascoste in edit) -->
      <section class="card quick-actions hide-on-edit">
        <a id="btnSms" class="qa" href="#"><i class="fa-regular fa-message"></i><span>Messaggio</span></a>
        <a id="btnCall" class="qa" href="#"><i class="fa-solid fa-phone"></i><span>Chiama</span></a>
        <a id="btnWa"   class="qa" href="#" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp"></i><span>WhatsApp</span></a>
        <a id="btnApp"  class="qa" href="nuovo-appuntamento.html"><i class="fa-solid fa-calendar-plus"></i><span>Nuovo App.</span></a>
        <a id="btnRem"  class="qa" href="#"><i class="fa-solid fa-bell"></i><span>Promemoria</span></a>
      </section>
    </div>

    <!-- INFO (view + inline edit) -->
    <section class="card form-list" id="infoCard">
      <!-- vista -->
      <div id="infoView">
        <div class="row">
          <div class="label">Cellulare</div>
          <a class="value link" id="infoPhone" href="#">—</a>
        </div>
        <div class="row" id="rowEmail" style="display:none;">
          <div class="label">Email</div>
          <a class="value link" id="infoEmail" href="#">—</a>
        </div>
      </div>

      <!-- edit inline (nome/tel/email) -->
      <form id="infoEdit" class="edit-inline" style="display:none">
        <label for="editNome">Nome</label>
        <input id="editNome" type="text" required autocomplete="name">

        <label for="editTelefono">Telefono</label>
        <input id="editTelefono" type="tel" required inputmode="numeric" autocomplete="tel">

        <label for="editEmail">Email (opzionale)</label>
        <input id="editEmail" type="email" inputmode="email" autocomplete="email">

        <div class="edit-actions">
          <!-- invertiti: Annulla a sinistra, Salva a destra -->
          <button type="button" class="btn-secondary" id="cancelInline">
            <i class="fa-solid fa-times"></i> Annulla
          </button>
          <button type="submit" class="btn-primary">
            <i class="fa-solid fa-check"></i> Salva
          </button>
        </div>
      </form>
    </section>

    <!-- NOTE (sempre modificabili) -->
    <section class="card note-card" id="noteCard">
      <div class="note-head">
        <h2>Note</h2>
        <small id="noteStatus" class="note-status" aria-live="polite"></small>
      </div>
      <textarea id="noteInput" rows="4" placeholder="Aggiungi una nota…"></textarea>
    </section>

    <!-- STATISTICHE (scompaiono in edit) -->
    <section class="card stats-card hide-on-edit">
      <div class="card-title">
        <h2 class="stats-title">Statistiche</h2>
        <select id="yearSelect" class="inline-year"></select>
      </div>

      <div class="bars">
        <div class="bar">
          <div class="bar-top"><span>Anno</span><strong id="valAnno">€ 0,00</strong></div>
          <div class="bar-track"><div class="bar-fill" id="barAnno"></div></div>
        </div>
        <div class="bar">
          <div class="bar-top"><span>Totale</span><strong id="valTotale">€ 0,00</strong></div>
          <div class="bar-track"><div class="bar-fill" id="barTotale"></div></div>
        </div>
      </div>

      <div class="by-treatment">
        <div class="bt-title">Dettaglio per trattamento (anno)</div>
        <ul id="yearByTreatment" class="bt-list"><li>—</li></ul>
      </div>
    </section>

    <!-- STORICO (solo ultimi 3) -->
    <section class="card history-card hide-on-edit">
      <h2>Storico appuntamenti</h2>
      <ul id="historyList" class="history"></ul>
      <div class="history-actions">
        <button id="openHistoryModal" class="link-btn" style="display:none">
          Mostra tutti
        </button>
      </div>
    </section>

    <!-- MODALE STORICO COMPLETO -->
    <div id="historyModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
      <div class="modal__backdrop" data-close></div>
      <div class="modal__dialog" role="document" aria-labelledby="historyModalTitle">
        <header class="modal__header">
          <h3 id="historyModalTitle">Storico appuntamenti</h3>
          <div class="modal__controls">
            <select id="modalYearSelect" class="inline-year small"></select>
            <button class="icon-btn" id="closeHistoryModal" aria-label="Chiudi">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
        </header>
        <div class="modal__body">
          <ul id="modalHistoryList" class="history modal-history"></ul>
        </div>
      </div>
    </div>
  </main>

  <script>
    fetch("navbar.html").then(r=>r.text()).then(h=>document.getElementById("navbar-placeholder").innerHTML=h);
  </script>
  <script type="module" src="cliente.js"></script>
</body>
</html>