<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scheda Cliente</title>
  <link rel="stylesheet" href="navbar.css" />
  <link rel="stylesheet" href="cliente.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <!-- navbar bottom -->
  <div id="navbar-placeholder"></div>

  <main class="cliente-page">
    <!-- HEADER -->
    <header class="page-header">
      <button class="icon-btn" id="backBtn" aria-label="Indietro">
        <i class="fa-solid fa-chevron-left"></i>
      </button>

      <div class="header-actions">
        <button class="chip-btn" id="editBtnTop" aria-label="Modifica">
          <i class="fa-solid fa-pen"></i>
          <span>Modifica</span>
        </button>
      </div>
    </header>

    <!-- HERO -->
    <section class="hero">
      <div class="avatar" id="avatarIniziali">AA</div>
      <div class="identity">
        <div class="display-name" id="displayName">—</div>
      </div>
    </section>

    <!-- QUICK ACTIONS -->
    <section class="card quick-actions">
      <a id="btnSms" class="qa" href="#"><i class="fa-regular fa-message"></i><span>Messaggio</span></a>
      <a id="btnCall" class="qa" href="#"><i class="fa-solid fa-phone"></i><span>Chiama</span></a>
      <a id="btnWa"   class="qa" href="#" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp"></i><span>WhatsApp</span></a>
      <a id="btnApp"  class="qa" href="nuovo-appuntamento.html"><i class="fa-solid fa-calendar-plus"></i><span>Nuovo App.</span></a>
      <a id="btnRem"  class="qa" href="#"><i class="fa-solid fa-bell"></i><span>Promemoria</span></a>
    </section>

    <!-- INFO (lettura) -->
    <section class="card form-list">
      <div class="row">
        <div class="label">Cellulare</div>
        <a class="value link" id="infoPhone" href="#">—</a>
      </div>
      <div class="row" id="rowEmail" style="display:none;">
        <div class="label">Email</div>
        <a class="value link" id="infoEmail" href="#">—</a>
      </div>
    </section>

    <!-- EDIT INLINE – stile “Rubrica iPhone” -->
    <section class="ios-section" id="editSection" hidden>
      <h3 class="ios-section-title">Modifica contatto</h3>

      <!-- gruppo “Nome” -->
      <div class="ios-group">
        <label class="ios-cell">
          <span class="ios-cell-label">Nome</span>
          <input id="editNome" type="text" class="ios-input" placeholder="Nome" required>
        </label>
      </div>

      <!-- gruppo “Telefono” -->
      <div class="ios-group">
        <label class="ios-cell">
          <span class="ios-cell-label">Telefono</span>
          <input id="editTelefono" type="tel" inputmode="numeric" class="ios-input" placeholder="Numero" required>
        </label>
      </div>

      <!-- gruppo “Email” -->
      <div class="ios-group">
        <label class="ios-cell">
          <span class="ios-cell-label">Email</span>
          <input id="editEmail" type="email" inputmode="email" class="ios-input" placeholder="opzionale">
        </label>
      </div>

      <!-- toolbar azioni -->
      <form id="editForm" class="ios-toolbar">
        <button type="button" class="ios-link" id="cancelEdit">Annulla</button>
        <button type="submit" class="ios-primary">Salva</button>
      </form>
    </section>

    <!-- STATISTICHE -->
    <section class="card stats-card">
      <div class="card-title">
        <h2>Statistiche</h2>
        <div class="year-select">
          <label for="yearSelect" class="sr-only">Anno</label>
          <select id="yearSelect"></select>
        </div>
      </div>

      <div class="bars">
        <div class="bar">
          <div class="bar-top"><span>Anno</span><strong id="valAnno">€ 0,00</strong></div>
          <div class="bar-track"><div class="bar-fill" id="barAnno"></div></div>
        </div>
        <div class="bar">
          <div class="bar-top"><span>Totale</span><strong id="valTotale">€ 0,00</strong></div>
          <div class="bar-track"><div class="bar-fill" id="barTotale"></div></div>
        </div>
      </div>

      <div class="by-treatment">
        <div class="bt-title">Dettaglio per trattamento (anno)</div>
        <ul id="yearByTreatment" class="bt-list"><li>—</li></ul>
      </div>
    </section>

    <!-- STORICO -->
    <section class="card history-card">
      <h2>Storico appuntamenti</h2>
      <ul id="historyList" class="history"></ul>
    </section>
  </main>

  <script>
    fetch("navbar.html").then(r=>r.text()).then(h=>document.getElementById("navbar-placeholder").innerHTML=h);
  </script>
  <script type="module" src="cliente.js"></script>
  <script>
    // piccolo toggle: quando premi "Modifica", mostro/nascondo la sezione stile rubrica
    const editBtnTop = document.getElementById('editBtnTop');
    const editSection = document.getElementById('editSection');
    const cancelEdit = document.getElementById('cancelEdit');

    editBtnTop?.addEventListener('click', () => {
      editSection.hidden = !editSection.hidden;
      if (!editSection.hidden) window.scrollTo({ top: editSection.offsetTop - 12, behavior: 'smooth' });
    });
    cancelEdit?.addEventListener('click', () => { editSection.hidden = true; });
  </script>
</body>
</html>