<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scheda Cliente</title>
  <link rel="stylesheet" href="navbar.css">
  <link rel="stylesheet" href="cliente.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <!-- navbar bottom -->
  <div id="navbar-placeholder"></div>

  <main class="cliente-page">
    <!-- AREA SUPERIORE TINTA: header + hero + quick actions -->
    <div class="top-area">
      <!-- HEADER -->
      <header class="page-header">
        <button class="icon-btn" id="backBtn" aria-label="Indietro">
          <i class="fa-solid fa-chevron-left"></i>
        </button>
        <div class="header-actions">
          <button class="icon-btn pill-btn" id="editBtnTop" aria-label="Modifica">
            <i class="fa-solid fa-pen"></i>
            <span>Modifica</span>
          </button>
        </div>
      </header>

      <!-- HERO -->
      <section class="hero">
        <div class="avatar" id="avatarIniziali">AA</div>
        <div class="identity">
          <div class="display-name" id="displayName">—</div>
        </div>
      </section>

      <!-- QUICK ACTIONS -->
      <section class="card quick-actions hide-on-edit">
        <a id="btnSms" class="qa" href="#"><i class="fa-regular fa-message"></i><span>Messaggio</span></a>
        <a id="btnCall" class="qa" href="#"><i class="fa-solid fa-phone"></i><span>Chiama</span></a>
        <a id="btnWa"   class="qa" href="#" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp"></i><span>WhatsApp</span></a>
        <a id="btnApp"  class="qa" href="nuovo-appuntamento.html"><i class="fa-solid fa-calendar-plus"></i><span>Nuovo App.</span></a>
        <a id="btnRem"  class="qa" href="#"><i class="fa-solid fa-bell"></i><span>Promemoria</span></a>
      </section>
    </div>

    <!-- INFO -->
    <section class="card form-list" id="infoCard">
      <div id="infoView">
        <div class="row">
          <div class="label">Cellulare</div>
          <a class="value link" id="infoPhone" href="#">—</a>
        </div>
        <div class="row" id="rowEmail" style="display:none;">
          <div class="label">Email</div>
          <a class="value link" id="infoEmail" href="#">—</a>
        </div>
      </div>

      <!-- edit inline -->
      <form id="infoEdit" class="edit-inline" style="display:none">
        <label for="editNome">Nome</label>
        <input id="editNome" type="text" required autocomplete="name">

        <label for="editTelefono">Telefono</label>
        <input id="editTelefono" type="tel" required inputmode="numeric" autocomplete="tel">

        <label for="editEmail">Email (opzionale)</label>
        <input id="editEmail" type="email" inputmode="email" autocomplete="email">

        <div class="edit-actions">
          <button type="button" class="btn-secondary" id="cancelInline">
            <i class="fa-solid fa-times"></i> Annulla
          </button>
          <button type="submit" class="btn-primary">
            <i class="fa-solid fa-check"></i> Salva
          </button>
        </div>
      </form>
    </section>

    <!-- NOTE -->
    <section class="card note-card" id="noteCard">
      <div class="note-head">
        <h2>Note</h2>
        <small id="noteStatus" class="note-status" aria-live="polite"></small>
      </div>
      <textarea id="noteInput" rows="4" placeholder="Aggiungi una nota…"></textarea>
    </section>

    <!-- STATISTICHE -->
    <section class="card stats-card hide-on-edit">
      <div class="card-title">
        <h2 class="stats-title">Statistiche</h2>

        <!-- Navigazione anno in stile iOS -->
        <div class="year-nav">
          <button type="button" class="year-btn" id="yearPrev"><i class="fa-solid fa-chevron-left"></i></button>
          <span class="year-label" id="yearLabel">2025</span>
          <button type="button" class="year-btn" id="yearNext"><i class="fa-solid fa-chevron-right"></i></button>
        </div>

        <!-- Select nascosto (serve solo a JS) -->
        <select id="yearSelect" class="inline-year" style="display:none"></select>
      </div>

      <div class="bars">
        <div class="bar">
          <div class="bar-top"><span>Anno</span><strong id="valAnno">€ 0,00</strong></div>
          <div class="bar-track"><div class="bar-fill" id="barAnno"></div></div>
        </div>
        <div class="bar">
          <div class="bar-top"><span>Totale</span><strong id="valTotale">€ 0,00</strong></div>
          <div class="bar-track"><div class="bar-fill" id="barTotale"></div></div>
        </div>
      </div>

      <div class="by-treatment">
        <div class="bt-title">Dettaglio per trattamento (anno)</div>
        <ul id="yearByTreatment" class="bt-list"><li>—</li></ul>
      </div>
    </section>

    <!-- STORICO -->
    <section class="card history-card hide-on-edit">
      <h2>Storico appuntamenti</h2>
      <ul id="historyList" class="history"></ul>
      <button id="showAllHistory" class="link-btn" style="display:none">Mostra tutti</button>
    </section>
  </main>

  <!-- Bottom Sheet -->
  <div class="sheet" id="historySheet" hidden aria-hidden="true">
    <div class="sheet-backdrop" id="sheetBackdrop"></div>

    <div class="sheet-panel" role="dialog" aria-modal="true" aria-labelledby="sheetTitle">
      <div class="sheet-header">
        <div class="sheet-handle" aria-hidden="true"></div>
        <button class="sheet-close" id="sheetClose" aria-label="Chiudi">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <div class="sheet-titlebar">
        <h3 id="sheetTitle">Storico appuntamenti</h3>

        <!-- Navigazione anno -->
        <div class="year-nav">
          <button type="button" class="year-btn" id="sheetYearPrev"><i class="fa-solid fa-chevron-left"></i></button>
          <span class="year-label" id="sheetYearLabel">2025</span>
          <button type="button" class="year-btn" id="sheetYearNext"><i class="fa-solid fa-chevron-right"></i></button>
        </div>

        <!-- Select nascosto -->
        <select id="sheetYear" class="inline-year" style="display:none"></select>
      </div>

      <div class="sheet-content">
        <ul id="sheetHistory" class="history"></ul>
      </div>
    </div>
  </div>

  <script>
    fetch("navbar.html")
      .then(r=>r.text())
      .then(h=>document.getElementById("navbar-placeholder").innerHTML=h);
  </script>
  <script type="module" src="cliente.js"></script>
</body>
</html>